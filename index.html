<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'
	  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html>
  <head>
    <center>
      <h1>FLDigi Ruby Gem</h1>
    </center>
  </head>
  <body bgcolor="E6E6E6">
    <p>I love FLDigi.  One of my favorite features is the API.  But
      talking directly to the XML-RPC API is a bit of a pain in the ass
      from random ruby code, so I wrote a gem to abstract it a layer,
      and remove some of the "ick" factor.  The documenation for the
      FLDigi API is, to put it kindly, a little lacking.  It basically
      amounts to a one-line description of each call
      (see <a href="http://www.w1hkj.com/FldigiHelp-3.22/xmlrpc-control.html">here</a>).
      The best documenation has turned out to be reading the FLDigi
      source.</p>

    <p>At any rate, I've written a gem to make all of this just a bit
      easier to use.  I've also written a few demonstration clients.
      The first client allows you to send CQ from the command line, or
      to send any arbitrary text, using whatever frequency, carrier,
      mode, and modem you wish.  The second client is a PropNET client
      written in ruby that uses FLDigi as a modem.  Be aware that I
      haven't tested the propnet client yet, other than to verify that
      the output looks sane.  The third client (not quite ready to
      publish) is an PSK31/PSK63 APRS client.  At this point, there is
      no documentation save this page and the demo code.</p>

    <p>This code has been tested on Linux and OS/X, and so far, works
      perfectly.  I do not own or currently have access to a Windows
      box, so your mileage may vary there.  Please provide feedback for
      features and bugs.  My time is limited, but I'll do what I can.
      My intent is that library calls won't change, only new calls will
      be added, but at this point, it's early enough in the development
      cycle that I can't promise that.</p>
    
    <p>There's a lot to be desired in things like validating and
      error-checking of user input.  For example, if you enter bogus
      fields for phg (for propnet), it'll either send bad data, or
      barf, depending on which value you hork up.  Input validation is
      on the very long list of To-Do items.</p>

    <p>This code is still very much in the initial "figuring things
      out" stage, so my apologies in advance, but things are going to
      break from time to time.  For example, I just changed freq.
      freq used to be an instance variable that indicated (or set) the
      dial frequency.  I changed freq to dial_freq to be more
      accurate, and added the method freq() to get/set the actual
      transmit/receive frequency (ie, dial freqency plus carrier).  If
      you wrote some code using the old library, I just broke it.  But
      in the long term, it's better that way.</p>

    <p>The digitool.rb script does a bunch of random (and hopefully
       useful) things.  It'll call CQ for you, it'll randomly tune
       around the band segment you're in, finding QSOs and printing
       them, and other assorted things.  Mostly, it serves as an
       example of how to use the fldigi library.  I tried to make the
       defaults reasonably sane.  For example, unless you specify
       otherwise (by using --carrier), the audio carrier defaults to
       1000hz.  so if you say "./digitool.rb --txfreq 14071000", it'll
       set your dial frequency to 14070000hz and your carrier to
       1000hz, so your transmit (and receive) frequency will be
       14071000hz.  If you tell it "./digitool.rb --dialfreq
       14070000", you'll get exactly the same transmit/receive
       frequency.  Hopefully, being able to specify the dial
       frequency, the transmit frequency, and/or the carrier frequency
       will clear up some of the problems that newcomers have to using
       digital modes.  I sometimes find it useful to do something like:</p>

    <p>
      <pre>
	<code>
	  while [ 1 ]; do ./digitool.rb --call n0gq --cq --txfreq 14106500 --carrier 1500 --modem Olivia-32-1K --listen 60; done
	</code>
      </pre>
    </p>

    <p>This will transmit a CQ on 20M in Olivia 32/1000, listen for
       sixty seconds, then repeat forever.  If/when I get an answer, I
       just ^C the script, and move over to FLDigi for the QSO.</p>

    <p>In the mean time, here are links to the library and the demo
      code (make sure you always have the latest library, or the demo
      code may not work):</p>

    <ul>
      <li><a href="https://rubygems.org/gems/fldigi">Here</a> is where
	you can get the library.  Or just do <i>sudo gem install
	  fldigi</i> from the command line.</li>
      <li><a href="digitool.rb">digitool.rb</a> is a simple client for
	sending CQ and one-line text strings (and setting the radio
	parameters)</li>
      <li><a href="propnet.rb">propnet.rb</a> is an <b>untested</b>
	client for PropNet</li>
      <li>hfaprs.rb</li>
    </ul>

    Here's a simple example to call CQ where you specify the dial
    frequency and the desired carrier.  This example will transmit on
    14071000hz:
    <p>
      <pre>
	<code>
	  require 'fldigi'

	  fldigi=Fldigi.new()
	  fldigi.call="N0CLU"
	  fldigi.carrier=1000
	  fldigi.dial_freq=14070000
	  fldigi.modem="BPSK31"
	  if fldigi.config()
	    fldigi.clear_tx_data()
	    fldigi.get_tx_data()
	    fldigi.cq()
	    fldigi.send_buffer()
	  end
	</code>
      </pre>
    </p>

    Here's a different way to do the same thing.  This time, we
    specify the desired transmit frequency, rather than specifying the
    dial frequency (just set fldigi.carrier to the sweet spot in your
    audio first).  This example also transmits on 14071000hz, it's
    just a different way of doing the same thing:
    <p>
      <pre>
	<code>
	  require 'fldigi'

	  fldigi=Fldigi.new()
	  fldigi.call="N0CLU"
	  fldigi.carrier=1000
	  fldigi.freq(14071000)
	  fldigi.modem="BPSK31"
	  if fldigi.config()
	    fldigi.clear_tx_data()
	    fldigi.get_tx_data()
	    fldigi.cq()
	    fldigi.send_buffer()
	  end
	</code>
      </pre>
    </p>

    Here's a simple example to send a random bit of text:
    <p>
      <pre>
	<code>
	  require 'fldigi'

	  fldigi=Fldigi.new()
	  fldigi.dial_freq=18110000
	  fldigi.carrier=1200
	  fldigi.modem="BPSK63"
	  if fldigi.config()
	    fldigi.clear_tx_data()
	    fldigi.get_tx_data()
	    fldigi.add_tx_string("This is a random bit of text de N0CLU")
	    fldigi.send_buffer()
	  end
	</code>
      </pre>
    </p>

    Here's a simple example to send a PropNet beacon:
    <p>
      <pre>
	<code>
	  require 'fldigi'

	  fldigi=Fldigi.new()
	  fldigi.call="N0CLU"
	  fldigi.band=20
	  fldigi.phg="PHG410015"
	  fldigi.grid="CN87wu"
	  fldigi.propnet()
	  if fldigi.config()
	    fldigi.clear_tx_data()
 	    fldigi.get_tx_data()
	    while true
	      fldigi.send_buffer()
 	      sleep fldigi.delay
	    end
	  end
	</code>
      </pre>
    </p>

    <p>
      The full git source repository lives <a href="https://github.com/jfrancis42/fldigi-ruby">here</a>.
    </p>

    <p>Best of luck, 73.</p>
    <p>Jeff Francis, N0GQ, jeff(at)gritch.org</p>
  </body>
</html>
